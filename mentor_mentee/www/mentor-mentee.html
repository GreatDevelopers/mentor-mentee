<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Mentor Mentee System</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-4">
  <h2 class="text-center">Mentor Mentee System</h2>
  <div class="row mt-4">
    <div class="col-md-4">
      <h4>Instructors</h4>
      <ul id="instructors-list" class="list-group"></ul>
    </div>
    <div class="col-md-8">
      <h4>Student Groups</h4>
      <div id="groups-list"></div>
    </div>
  </div>
  
  <script>
    $(document).ready(function () {
      const BASE_URL = "http://mentor-mentee.localhost:8002";
      
      $.get(`${BASE_URL}/api/resource/Instructor`, function (data) {
        console.log("Instructors API Response:", data);
        data.data.forEach(inst => {
          $("#instructors-list").append(`
            <li class="list-group-item instructor-item" data-instructor="${inst.name}" style="cursor: pointer;">
              ${inst.name}
            </li>
          `);
        });
      
        $(".instructor-item").click(function () {
          let instructorName = $(this).data("instructor");
          console.log("Instructor clicked:", instructorName);
      
          $("#groups-list").html("");
      
          let processed = 0;
          let matchedCount = 0;
      
          $.get(`${BASE_URL}/api/resource/Student Group`, function (groupData) {
            console.log("Student Groups API Response:", groupData);
            if(groupData.data.length === 0){
              $("#groups-list").html("<div class='alert alert-warning mt-3'>No student groups available.</div>");
              return;
            }
      
            groupData.data.forEach(group => {
              $.get(`${BASE_URL}/api/resource/Student Group/${group.name}`, function (groupDetail) {
                console.log("Student Group Details:", groupDetail);
                processed++;
      
                let instructor = groupDetail.data.instructors[0]?.instructor_name || "No Instructor";
      
                if (instructor === instructorName) {
                  matchedCount++;
                  let studentNames = [];
                  let studentFetchCount = 0;
      
                  if (!groupDetail.data.students || groupDetail.data.students.length === 0) {
                    $("#groups-list").append(`
                      <div class="card mt-3">
                        <div class="card-header bg-primary text-white">${groupDetail.data.student_group_name}</div>
                        <div class="card-body">
                          <p><strong>Instructor:</strong> ${instructor}</p>
                          <p><strong>Students:</strong> No student assigned.</p>
                        </div>
                      </div>
                    `);
                  } else {
                    groupDetail.data.students.forEach(s => {
                      $.get(`${BASE_URL}/api/resource/Student/${s.student}`, function (studentData) {
                        let studentFullName = studentData.data.student_name;
                        studentNames.push(studentFullName);
                        studentFetchCount++;
      
                        if (studentFetchCount === groupDetail.data.students.length) {
                          $("#groups-list").append(`
                            <div class="card mt-3">
                              <div class="card-header bg-primary text-white">${groupDetail.data.student_group_name}</div>
                              <div class="card-body">
                                <p><strong>Instructor:</strong> ${instructor}</p>
                                <p><strong>Students:</strong> ${studentNames.join(", ")}</p>
                              </div>
                            </div>
                          `);
                        }
                      });
                    });
                  }
                }
      
                if (processed === groupData.data.length && matchedCount === 0) {
                  $("#groups-list").html("<div class='alert alert-warning mt-3'>No student assigned.</div>");
                }
              });
            });
          });
        });
      });
    });
  </script>
</body>
</html>

